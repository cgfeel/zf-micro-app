**1. 注入资源：**

| 加载方式                                                                                                                                                                                      | 调用场景                                                                                                                                                               | 加载样式               | 说明                                                    |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------- | ------------------------------------------------------- |
| `renderTemplateToShadowRoot` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#rendertemplatetoshadowroot-%E6%B8%B2%E6%9F%93%E8%B5%84%E6%BA%90%E5%88%B0-shadowroot)] | `active`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/sandbox.ts#L232)]                    | 🌟 `WUJIE_SHADE_STYLE` | 由基座提供的静态样式，用于撑开应用                      |
| `patchRenderEffect` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#patchrendereffect-%E4%B8%BA%E5%AE%B9%E5%99%A8%E6%89%93%E8%A1%A5%E4%B8%81)]                     | `renderTemplateToShadowRoot`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/shadow.ts#L235)] | 没有                   | 不加载样式，只重写 `Dom` 写入操作，为动态加载样式做准备 |
| `patchCssRules` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#-patchcssrules-%E5%AD%90%E5%BA%94%E7%94%A8%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)]          | `active`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/sandbox.ts#L233)]                    | 没有                   | 静态样式中没有匹配到，等待 `script` 注入后动态渲染样式  |
| `insertScriptToIframe` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#insertscripttoiframe%E4%B8%BA%E6%B2%99%E7%AE%B1%E6%8F%92%E5%85%A5-script)]                  | `start`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/sandbox.ts#L286)]                     | 没有                   | 注入 `script` 渲染应用                                  |

**2. 动态加载 `index.css`：**

| 加载方式                                                                                                                                                                                                                                    | 调用场景                                                                                                                                                               | 加载样式             | 说明                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | ------------------------------------------------------------------------------ |
| `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L158)]                                                                      | `patchRenderEffect`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L427)]          | 没有                 | 劫持 `Dom` 写入                                                                |
| `styles` - `rawDOMAppendOrInsertBefore`                                                                                                                                                                                                     | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L251)] | 🌟 空的 `style` 元素 | 来自 `React` 应用添加                                                          |
| `patchStylesheetElement` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#patchstylesheetelement%E5%8A%AB%E6%8C%81%E5%A4%84%E7%90%86%E6%A0%B7%E5%BC%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%B1%9E%E6%80%A7)]             | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L253)] | 没有                 | 劫持 `style` 写入操作                                                          |
| `handleStylesheetElementPatch` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)] | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L254)] | 没有                 | `style` 内容为空，跳过不处理                                                   |
| `appendChild`                                                                                                                                                                                                                               | `patchStylesheetElement`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L139)]     | `index.css`          | 将样式内容注入 `style` 元素，添加一个微任务执行 `handleStylesheetElementPatch` |

**3. 动态加载 `App.css`：**

| 加载方式                                                                                                                                                                                                                                    | 调用场景                                                                                                                                                               | 加载样式             | 说明                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | ------------------------------------------------------------------------------ |
| `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L158)]                                                                      | `patchRenderEffect`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L427)]          | 没有                 | 劫持 `Dom` 写入                                                                |
| `styles` - `rawDOMAppendOrInsertBefore`                                                                                                                                                                                                     | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L251)] | 🌟 空的 `style` 元素 | 来自 `React` 应用添加                                                          |
| `patchStylesheetElement` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#patchstylesheetelement%E5%8A%AB%E6%8C%81%E5%A4%84%E7%90%86%E6%A0%B7%E5%BC%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%B1%9E%E6%80%A7)]             | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L253)] | 没有                 | 劫持 `style` 写入操作                                                          |
| `handleStylesheetElementPatch` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)] | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L254)] | 没有                 | `style` 内容为空，跳过不处理                                                   |
| `appendChild`                                                                                                                                                                                                                               | `patchStylesheetElement`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L139)]     | `App.css`            | 将样式内容注入 `style` 元素，添加一个微任务执行 `handleStylesheetElementPatch` |

**4. 提取样式打补丁：**

| 加载方式                                                                                                                                                                                                                                    | 调用场景                                                                                                                                                                | 加载样式                        | 说明                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- | ----------------------------------------------------------------- |
| `handleStylesheetElementPatch` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)] | `appendChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L141)]                 | 没有                            | `index.css` 打补丁，发起宏任务 `patcher`                          |
| `handleStylesheetElementPatch` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)] | `appendChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L141)]                 | 没有                            | `App.css` 打补丁，发起宏任务 `patcher`                            |
| `patcher`，见：源码 [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)]            | `handleStylesheetElementPatch`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L66)] | `:host`                         | 从 `index.css` 中提取 `:host`，通过 `appendChild` 插入容器 `head` |
| `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L158)]                                                                      | `patchRenderEffect`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L427)]           | 没有                            | 劫持 `Dom` 写入                                                   |
| `styles` - `rawDOMAppendOrInsertBefore`                                                                                                                                                                                                     | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L251)]  | 🌟 将提取的 `:host` 插入 `head` | 由于 `head` 的写入被重写，所以 `:host` 也被拦截                   |
| `patchStylesheetElement` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#patchstylesheetelement%E5%8A%AB%E6%8C%81%E5%A4%84%E7%90%86%E6%A0%B7%E5%BC%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%B1%9E%E6%80%A7)]             | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L253)]  | 没有                            | 拦截 `style` 属性，但 `:host` 无需再操作                          |
| `handleStylesheetElementPatch` [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)] | `rewriteAppendOrInsertChild`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L254)]  | 没有                            | `:host` 打补丁，发起宏任务 `patcher`                              |
| `patcher`，见：源码 [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)]            | `handleStylesheetElementPatch`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L66)] | 🌟 `@font-face`                 | 从 `index.css` 中提取 `@font-face` 插入 `shadowRoot.host`         |
| `patcher`，见：源码 [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)]            | `handleStylesheetElementPatch`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L66)] | 没有                            | `App.css` 中没有提取到样式需要打补丁                              |
| `patcher`，见：源码 [[查看](https://github.com/cgfeel/micro-wujie-substrate?tab=readme-ov-file#handlestylesheetelementpatch%E4%B8%BA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F%E6%89%93%E8%A1%A5%E4%B8%81)]            | `handleStylesheetElementPatch`，见：源码 [[查看](https://github.com/Tencent/wujie/blob/9733864b0b5e27d41a2dc9fac216e62043273dd3/packages/wujie-core/src/effect.ts#L66)] | 没有                            | `:host` 中没有提取到样式需要打补丁                                |
